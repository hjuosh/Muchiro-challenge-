<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Muichiro Quest - Final</title>
    
    <script type="module">
        import { GoogleGenerativeAI } from "https://esm.run/@google/generative-ai";

        // CONFIGURACI√ìN - API KEY VERIFICADA
        const API_KEY = "AIzaSyAvMft71HUbpDO6XV6-7csGG5wRznc-Zag"; 

        const genAI = new GoogleGenerativeAI(API_KEY);
        
        // CORRECCI√ìN T√âCNICA: Forzamos 'v1' para eliminar el error 404 de tus capturas
        const model = genAI.getGenerativeModel({ 
            model: "gemini-1.5-flash",
        }, { apiVersion: 'v1' });

        const systemPrompt = "Eres Muichiro Tokito. Eres distra√≠do y po√©tico. Ayuda con pistas pero NUNCA digas 'Kanamori' ni 'Oboro' directamente. Si preguntan por el herrero, di que usa gafas. Si preguntan por la 7ma postura, di que confunde como la neblina.";

        let chat = model.startChat({
            history: [
                { role: "user", parts: [{ text: systemPrompt }] },
                { role: "model", parts: [{ text: "La niebla se disipa... ¬øen qu√© puedo ayudarte?" }] }
            ],
        });

        window.preguntarGemini = async () => {
            const input = document.getElementById('chat-input');
            const log = document.getElementById('chat-log');
            if (!input.value) return;

            log.innerHTML += `<div><b>T√∫:</b> ${input.value}</div>`;
            const userMsg = input.value;
            input.value = "";

            try {
                const result = await chat.sendMessage(userMsg);
                const response = await result.response;
                log.innerHTML += `<div style="color:#5de2e7; font-style:italic; margin-top:5px;">Muichiro: ${response.text()}</div>`;
            } catch (err) {
                console.error("Error detallado:", err);
                log.innerHTML += `<div style="color:orange; margin-top:5px;">Muichiro: La niebla volvi√≥... (Recuerda desactivar el escudo del le√≥n en Brave o probar en Chrome).</div>`;
            }
            log.scrollTop = log.scrollHeight;
        };
    </script>

    <style>
        :root { --cyan: #5de2e7; --dark: #0b1014; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--dark); color: white; margin: 0; text-align: center; }
        .main-wrapper { min-height: 100vh; padding: 20px; background: linear-gradient(180deg, #0b1014 0%, #1a2d2f 100%); }
        .container { max-width: 400px; margin: auto; }
        .hero-img { width: 100%; border-radius: 20px; border: 2px solid var(--cyan); margin-bottom: 20px; }
        .card { background: rgba(255, 255, 255, 0.08); backdrop-filter: blur(12px); border-radius: 25px; padding: 25px; border: 1px solid rgba(93, 226, 231, 0.2); }
        h1 { color: var(--cyan); font-size: 1.4rem; }
        input { width: 85%; padding: 12px; margin: 10px 0; border-radius: 10px; border: 1px solid var(--cyan); background: #111; color: white; text-align: center; font-size: 16px; }
        button { background: var(--cyan); color: #0b1014; border: none; padding: 15px; border-radius: 50px; cursor: pointer; width: 100%; font-weight: bold; margin-top: 10px; }
        .step { display: none; }
        .active { display: block; }
        #chat-window { display: none; position: fixed; bottom: 80px; right: 20px; width: 280px; background: #0b1014; border: 2px solid var(--cyan); border-radius: 15px; padding: 15px; text-align: left; z-index: 100; box-shadow: 0 10px 25px rgba(0,0,0,0.5); }
        #chat-log { height: 180px; overflow-y: auto; font-size: 0.85rem; margin-bottom: 10px; padding-right: 5px; }
        .prize-banner { background: #fff; color: #000; padding: 15px; border-radius: 15px; font-weight: bold; margin-top: 20px; border: 3px dashed var(--cyan); }
    </style>
</head>
<body>

<div class="main-wrapper">
    <div class="container">
        <img src="muichiro-tokito.jpg" class="hero-img">
        <div class="card">
            <div id="pantalla-inicio" class="active">
                <h1>MUICHIRO QUEST</h1>
                <button onclick="irAJuego()">CONTINUAR RECUERDOS</button>
            </div>

            <div id="game-content" style="display:none;">
                <div id="dia2" class="step active">
                    <h2>D√çA 2</h2>
                    <p>¬ø7ma postura?</p>
                    <input type="text" id="ans3">
                    <p>¬øHerrero actual?</p>
                    <input type="text" id="ans4">
                    <button onclick="validarDia2()">SELLAR</button>
                </div>
                
                <div id="dia3" class="step">
                    <h2>D√çA 3: EL FINAL</h2>
                    <p>¬øForma de la marca?</p>
                    <input type="text" id="ans5">
                    <p>¬øDetalle en la espada?</p>
                    <input type="text" id="ans6">
                    <button onclick="validarDia3()">RESCATAR A MUICHIRO</button>
                </div>
            </div>

            <div id="final" class="step">
                <h1 style="color: var(--cyan);">‚ú® RESCATADO ‚ú®</h1>
                <img src="tenor.gif" style="width:100%; border-radius:15px;">
                <div class="prize-banner">VE A TU CUARTO Y B√öSCALO...</div>
                <p style="font-size: 0.8rem; margin-top: 15px;">P.D. Te regalo este Atrapasue√±os para que siempre te rescates a ti misma.</p>
                <img src="atrapasue√±os.png" style="width:100%; border-radius:15px;">
            </div>
        </div>
    </div>

    <button onclick="toggleChat()" style="position:fixed; bottom:20px; right:20px; width:60px; height:60px; border-radius:50%; background:var(--cyan); border:none; font-size:1.5rem; cursor:pointer;">üå´Ô∏è</button>
    
    <div id="chat-window">
        <div id="chat-log">Muichiro: ¬øNecesitas ayuda con los recuerdos?</div>
        <div style="display:flex; gap:5px;">
            <input type="text" id="chat-input" placeholder="Escribe..." style="width:70%; font-size:0.8rem; margin:0;">
            <button onclick="preguntarGemini()" style="width:25%; padding:5px; font-size:0.7rem; margin:0;">Ir</button>
        </div>
    </div>
</div>

<script>
    function irAJuego() {
        document.getElementById('pantalla-inicio').style.display = 'none';
        document.getElementById('game-content').style.display = 'block';
    }
    function toggleChat() {
        const win = document.getElementById('chat-window');
        win.style.display = win.style.display === 'block' ? 'none' : 'block';
    }
    function validarDia2() {
        const r1 = document.getElementById('ans3').value.toLowerCase();
        const r2 = document.getElementById('ans4').value.toLowerCase();
        if((r1.includes("neblina") || r1.includes("oboro")) && r2.includes("kanamori")) {
            document.getElementById('dia2').classList.remove('active');
            document.getElementById('dia3').classList.add('active');
        } else { alert("Respuesta incorrecta. ¬°Habla con Muichiro!"); }
    }
    function validarDia3() {
        const r1 = document.getElementById('ans5').value.toLowerCase();
        const r2 = document.getElementById('ans6').value.toLowerCase();
        if(r1.includes("nube") && (r2.includes("telas") || r2.includes("guardamano"))) {
            document.getElementById('game-content').style.display = 'none';
            document.getElementById('final').classList.add('active');
        } else { alert("Casi lo logras... revisa el D√≠a 3"); }
    }
    document.getElementById('chat-input').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') window.preguntarGemini();
    });
</script>
</body>
</html>
