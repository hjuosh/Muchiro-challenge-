<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Muichiro Quest - Gemini Edition</title>
    
    <script type="importmap">
    {
      "imports": {
        "@google/generative-ai": "https://esm.run/@google/generative-ai"
      }
    }
    </script>

    <style>
        :root { --cyan: #5de2e7; --dark: #0b1014; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--dark); color: white; margin: 0; text-align: center; overflow-x: hidden; }
        .main-wrapper { min-height: 100vh; padding: 20px; background: linear-gradient(180deg, #0b1014 0%, #1a2d2f 100%); }
        .container { max-width: 400px; margin: auto; }
        .hero-img { width: 100%; border-radius: 20px; border: 2px solid var(--cyan); margin-bottom: 20px; box-shadow: 0 0 20px rgba(93, 226, 231, 0.3); }
        .card { background: rgba(255, 255, 255, 0.08); backdrop-filter: blur(12px); border-radius: 25px; padding: 25px; border: 1px solid rgba(93, 226, 231, 0.2); }
        h1 { color: var(--cyan); font-size: 1.4rem; margin-top: 0; }
        input { width: 85%; padding: 12px; margin: 10px 0; border-radius: 10px; border: 1px solid var(--cyan); background: #111; color: white; text-align: center; }
        .btn-main { background: var(--cyan); color: #0b1014; border: none; padding: 15px; border-radius: 50px; cursor: pointer; width: 100%; font-weight: bold; margin-top: 10px; }
        .step { display: none; }
        .active { display: block; animation: fadeIn 0.4s; }
        
        /* Chat de Gemini */
        #btn-chat { position: fixed; bottom: 20px; right: 20px; width: 60px; height: 60px; background: var(--cyan); border-radius: 50%; border: none; font-size: 1.5rem; cursor: pointer; z-index: 1000; box-shadow: 0 0 15px var(--cyan); }
        #chat-window { display: none; position: fixed; bottom: 90px; right: 20px; width: 300px; background: #0b1014; border: 2px solid var(--cyan); border-radius: 20px; padding: 15px; z-index: 1001; text-align: left; box-shadow: 0 10px 30px rgba(0,0,0,0.8); }
        #chat-log { height: 200px; overflow-y: auto; font-size: 0.85rem; color: #a0eef0; margin-bottom: 10px; border-bottom: 1px solid rgba(93,226,231,0.2); padding-bottom: 5px; }
        .msg { margin-bottom: 8px; line-height: 1.3; }
        .muichiro-msg { color: var(--cyan); font-style: italic; }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

<div class="main-wrapper">
    <div class="container">
        <img src="muichiro-tokito.jpg" class="hero-img" alt="Muichiro">
        
        <div class="card">
            <div id="pantalla-inicio" class="active">
                <h1>MUICHIRO QUEST</h1>
                <p style="font-style: italic; color: #a0eef0;">"La voluntad es el sol que disipa las nubes."</p>
                <button class="btn-main" onclick="irAJuego()">CONTINUAR DESAF√çO</button>
            </div>

            <div id="game-content" style="display:none;">
                <div id="dia2" class="step active">
                    <h2>D√çA 2</h2>
                    <p>¬øNombre de la 7ma postura?</p>
                    <input type="text" id="ans3" placeholder="Tu respuesta...">
                    <p>¬øQui√©n es su herrero actual?</p>
                    <input type="text" id="ans4" placeholder="Pista: Usa gafas...">
                    <button class="btn-main" onclick="validarDia2()">SELLAR RECUERDO</button>
                </div>
            </div>
        </div>
    </div>

    <button id="btn-chat" onclick="toggleChat()">üå´Ô∏è</button>

    <div id="chat-window">
        <div id="chat-log">
            <div class="msg muichiro-msg">Muichiro: ¬øMe buscabas? A veces olvido cosas... pero puedo ayudarte con la niebla de tus recuerdos.</div>
        </div>
        <div style="display: flex; gap: 5px;">
            <input type="text" id="chat-input" placeholder="Preg√∫ntame algo..." style="margin:0; width:70%; font-size: 0.8rem;">
            <button onclick="preguntarGemini()" style="width:25%; background:var(--cyan); border:none; border-radius:10px; font-weight:bold; cursor:pointer;">Ir</button>
        </div>
    </div>
</div>

<script type="module">
    import { GoogleGenerativeAI } from "@google/generative-ai";

    // 1. COLOCA TU API KEY AQU√ç
    const API_KEY = "AIzaSyCWb6tCNEWKZAupPeL9AzDr1bYhjUJVD2Q"; 
    
    const genAI = new GoogleGenerativeAI(API_KEY);
    const model = genAI.getGenerativeModel({ 
        model: "gemini-1.5-flash",
        systemInstruction: "Eres Muichiro Tokito de Demon Slayer. Tu personalidad es distra√≠da, calmada y un poco po√©tica. Est√°s ayudando a una ni√±a a resolver un reto sobre ti. REGLA SAGRADA: NUNCA digas la respuesta 'Kanamori' ni 'Oboro' directamente. Si pregunta por el herrero, dale pistas sobre Kanamori (el que usa gafas, el que es amigo de Haganezuka, el que forja para Inosuke). Si pregunta por la 7ma postura, di que es una neblina que confunde los sentidos. Si te pregunta algo que no sea del anime, di que te distrajiste mirando una nube."
    });

    let chat = model.startChat({ history: [] });

    // Funciones Globales para que los botones HTML las vean
    window.irAJuego = () => {
        document.getElementById('pantalla-inicio').style.display = 'none';
        document.getElementById('game-content').style.display = 'block';
    };

    window.toggleChat = () => {
        const chatWin = document.getElementById('chat-window');
        chatWin.style.display = chatWin.style.display === 'block' ? 'none' : 'block';
    };

    window.preguntarGemini = async () => {
        const input = document.getElementById('chat-input');
        const log = document.getElementById('chat-log');
        const texto = input.value;
        if (!texto) return;

        log.innerHTML += `<div class="msg">T√∫: ${texto}</div>`;
        input.value = "";
        log.scrollTop = log.scrollHeight;

        try {
            const result = await chat.sendMessage(texto);
            const response = await result.response;
            log.innerHTML += `<div class="msg muichiro-msg">Muichiro: ${response.text()}</div>`;
        } catch (err) {
            log.innerHTML += `<div class="msg muichiro-msg">Muichiro: La niebla se puso densa... intenta de nuevo.</div>`;
        }
        log.scrollTop = log.scrollHeight;
    };

    window.validarDia2 = () => {
        const r1 = document.getElementById('ans3').value.toLowerCase();
        const r2 = document.getElementById('ans4').value.toLowerCase();
        if ((r1.includes("neblina") || r1.includes("oboro")) && r2.includes("kanamori")) {
            alert("¬°D√≠a 2 superado! Ma√±ana ser√° el gran rescate.");
            location.reload();
        } else {
            alert("Los recuerdos a√∫n est√°n borrosos. ¬°Preg√∫ntale a Muichiro en el bot√≥n de abajo!");
        }
    };
</script>

</body>
</html>
